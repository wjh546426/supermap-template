define(["exports","./Check-07c613bc","./when-207a1520","./IndexDatatype-447558fc","./WebGLConstants-8d1e45f7"],(function(e,t,n,r,s){"use strict";function i(){return!0}function f(e,r){function s(){throw new t.t(r)}for(var f in r=n.u(r,"This object was destroyed, i.e., destroy() was called."),e)"function"==typeof e[f]&&(e[f]=s);e.isDestroyed=i}var o={STREAM_DRAW:s.B.STREAM_DRAW,STATIC_DRAW:s.B.STATIC_DRAW,DYNAMIC_DRAW:s.B.DYNAMIC_DRAW,validate:function(e){return e===o.STREAM_DRAW||e===o.STATIC_DRAW||e===o.DYNAMIC_DRAW}};function a(e){if(e=n.u(e,n.u.EMPTY_OBJECT),t.o.defined("options.context",e.context),!n.e(e.typedArray)&&!n.e(e.sizeInBytes))throw new t.t("Either options.sizeInBytes or options.typedArray is required.");if(n.e(e.typedArray)&&n.e(e.sizeInBytes))throw new t.t("Cannot pass in both options.sizeInBytes and options.typedArray.");if(n.e(e.typedArray)&&(t.o.typeOf.object("options.typedArray",e.typedArray),t.o.typeOf.number("options.typedArray.byteLength",e.typedArray.byteLength)),!o.validate(e.usage))throw new t.t("usage is invalid.");var r=e.context._gl,s=e.bufferTarget,i=e.typedArray,f=e.sizeInBytes,a=e.usage,u=n.e(i);u&&(f=i.byteLength),t.o.typeOf.number.greaterThan("sizeInBytes",f,0);var y=r.createBuffer();r.bindBuffer(s,y),r.bufferData(s,u?i:f,a),r.bindBuffer(s,null),this._gl=r,this._webgl2=e.context._webgl2,this._bufferTarget=s,this._sizeInBytes=f,this._usage=a,this._buffer=y,this.vertexArrayDestroyable=!0,this.context=e.context,e.context.memorySize+=f}a.createVertexBuffer=function(e){return t.o.defined("options.context",e.context),new a({context:e.context,bufferTarget:s.B.ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage})},a.createIndexBuffer=function(e){if(t.o.defined("options.context",e.context),!r.IndexDatatype.validate(e.indexDatatype))throw new t.t("Invalid indexDatatype.");if(e.indexDatatype===r.IndexDatatype.UNSIGNED_INT&&!e.context.elementIndexUint)throw new t.t("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var n=e.context,i=e.indexDatatype,f=r.IndexDatatype.getSizeInBytes(i),o=new a({context:n,bufferTarget:s.B.ELEMENT_ARRAY_BUFFER,typedArray:e.typedArray,sizeInBytes:e.sizeInBytes,usage:e.usage}),u=o.sizeInBytes/f;return Object.defineProperties(o,{indexDatatype:{get:function(){return i}},bytesPerIndex:{get:function(){return f}},numberOfIndices:{get:function(){return u}}}),o},Object.defineProperties(a.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}}),a.prototype._getBuffer=function(){return this._buffer},a.prototype.copyFromArrayView=function(e,r){r=n.u(r,0),t.o.defined("arrayView",e),t.o.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",r+e.byteLength,this._sizeInBytes);var s=this._gl,i=this._bufferTarget;s.bindBuffer(i,this._buffer),s.bufferSubData(i,r,e),s.bindBuffer(i,null)},a.prototype.copyFromBuffer=function(e,r,i,f){if(!this._webgl2)throw new t.t("A WebGL 2 context is required.");if(!n.e(e))throw new t.t("readBuffer must be defined.");if(!n.e(f)||f<=0)throw new t.t("sizeInBytes must be defined and be greater than zero.");if(!n.e(r)||r<0||r+f>e._sizeInBytes)throw new t.t("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!n.e(i)||i<0||i+f>this._sizeInBytes)throw new t.t("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===e._buffer&&(i>=r&&i<r+f||r>i&&r<i+f))throw new t.t("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===s.B.ELEMENT_ARRAY_BUFFER&&e._bufferTarget!==s.B.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==s.B.ELEMENT_ARRAY_BUFFER&&e._bufferTarget===s.B.ELEMENT_ARRAY_BUFFER)throw new t.t("Can not copy an index buffer into another buffer type.");var o=s.B.COPY_READ_BUFFER,a=s.B.COPY_WRITE_BUFFER,u=this._gl;u.bindBuffer(a,this._buffer),u.bindBuffer(o,e._buffer),u.copyBufferSubData(o,a,r,i,f),u.bindBuffer(a,null),u.bindBuffer(o,null)},a.prototype.getBufferData=function(e,r,i,f){if(r=n.u(r,0),i=n.u(i,0),!this._webgl2)throw new t.t("A WebGL 2 context is required.");if(!n.e(e))throw new t.t("arrayView is required.");var o,a,u=e.byteLength;if(n.e(f)?(o=f,n.e(u)?a=1:(u=e.length,a=e.BYTES_PER_ELEMENT)):n.e(u)?(o=u-i,a=1):(o=(u=e.length)-i,a=e.BYTES_PER_ELEMENT),i<0||i>u)throw new t.t("destinationOffset must be greater than zero and less than the arrayView length.");if(i+o>u)throw new t.t("destinationOffset + length must be less than or equal to the arrayViewLength.");if(r<0||r>this._sizeInBytes)throw new t.t("sourceOffset must be greater than zero and less than the buffers size.");if(r+o*a>this._sizeInBytes)throw new t.t("sourceOffset + length must be less than the buffers size.");var y=this._gl,h=s.B.COPY_READ_BUFFER;y.bindBuffer(h,this._buffer),y.getBufferSubData(h,r,e,i,f),y.bindBuffer(h,null)},a.prototype.isDestroyed=function(){return!1},a.prototype.destroy=function(){return this._gl.deleteBuffer(this._buffer),this.context.memorySize-=this.sizeInBytes,f(this)},e.A=o,e.h=a,e.i=f}));
