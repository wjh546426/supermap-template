define(["exports","./ArcType-198c1070","./arrayRemoveDuplicates-053c1528","./Cartesian2-4a5e3b0e","./Cartographic-dafe811b","./ComponentDatatype-662c7548","./when-207a1520","./Rectangle-49e286b5","./EllipsoidRhumbLine-b1de3107","./GeometryAttribute-9a541822","./GeometryAttributes-d4cebc09","./GeometryPipeline-35f216f8","./IndexDatatype-447558fc","./Math-bae672f2","./PrimitiveType-44685a19","./PolygonPipeline-63f52c70","./WindingOrder-380ced54"],(function(e,t,r,n,i,o,a,s,u,h,c,l,f,p,v,g,y){"use strict";function d(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(d.prototype,{length:{get:function(){return this._length}}}),d.prototype.enqueue=function(e){this._array.push(e),this._length++},d.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},d.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},d.prototype.contains=function(e){return-1!==this._array.indexOf(e)},d.prototype.clear=function(){this._array.length=this._offset=this._length=0},d.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var m={computeHierarchyPackedLength:function(e){for(var t=0,r=[e];r.length>0;){var n=r.pop();if(a.e(n)){t+=2;var o=n.positions,s=n.holes;if(a.e(o)&&(t+=o.length*i.t.packedLength),a.e(s))for(var u=s.length,h=0;h<u;++h)r.push(s[h])}}return t},packPolygonHierarchy:function(e,t,r){for(var n=[e];n.length>0;){var o=n.pop();if(a.e(o)){var s=o.positions,u=o.holes;if(t[r++]=a.e(s)?s.length:0,t[r++]=a.e(u)?u.length:0,a.e(s))for(var h=s.length,c=0;c<h;++c,r+=3)i.t.pack(s[c],t,r);if(a.e(u))for(var l=u.length,f=0;f<l;++f)n.push(u[f])}}return r},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],n=e[t++],o=new Array(r),a=n>0?new Array(n):void 0,s=0;s<r;++s,t+=i.t.packedLength)o[s]=i.t.unpack(e,t);for(var u=0;u<n;++u)a[u]=m.unpackPolygonHierarchy(e,t),t=a[u].startingIndex,delete a[u].startingIndex;return{positions:o,holes:a,startingIndex:t}}},b=new i.t;function I(e,t,r,n){return i.t.subtract(t,e,b),i.t.multiplyByScalar(b,r/n,b),i.t.add(e,b,b),[b.x,b.y,b.z]}m.subdivideLineCount=function(e,t,r){var n=i.t.distance(e,t)/r,o=Math.max(0,Math.ceil(p.e.log2(n)));return Math.pow(2,o)};var w=new i.t$1,_=new i.t$1,L=new i.t$1,x=new i.t;m.subdivideRhumbLineCount=function(e,t,r,n){var i=e.cartesianToCartographic(t,w),o=e.cartesianToCartographic(r,_),a=new u.P(i,o,e).surfaceDistance/n,s=Math.max(0,Math.ceil(p.e.log2(a)));return Math.pow(2,s)},m.subdivideLine=function(e,t,r,n){var o=m.subdivideLineCount(e,t,r),s=i.t.distance(e,t),u=s/o;a.e(n)||(n=[]);var h=n;h.length=3*o;for(var c=0,l=0;l<o;l++){var f=I(e,t,l*u,s);h[c++]=f[0],h[c++]=f[1],h[c++]=f[2]}return h},m.subdivideRhumbLine=function(e,t,r,n,i){var o=e.cartesianToCartographic(t,w),s=e.cartesianToCartographic(r,_),h=new u.P(o,s,e),c=h.surfaceDistance/n,l=Math.max(0,Math.ceil(p.e.log2(c))),f=Math.pow(2,l),v=h.surfaceDistance/f;a.e(i)||(i=[]);var g=i;g.length=3*f;for(var y=0,d=0;d<f;d++){var m=h.interpolateUsingSurfaceDistance(d*v,L),b=e.cartographicToCartesian(m,x);g[y++]=b.x,g[y++]=b.y,g[y++]=b.z}return g};var E=new i.t,S=new i.t,T=new i.t,A=new i.t;m.scaleToGeodeticHeightExtruded=function(e,t,r,n,o){n=a.u(n,s.t.WGS84);var u=E,h=S,c=T,l=A;if(a.e(e)&&a.e(e.attributes)&&a.e(e.attributes.position))for(var f=e.attributes.position.values,p=f.length/2,v=0;v<p;v+=3)i.t.fromArray(f,v,c),n.geodeticSurfaceNormal(c,u),l=n.scaleToGeodeticSurface(c,l),h=i.t.multiplyByScalar(u,r,h),h=i.t.add(l,h,h),f[v+p]=h.x,f[v+1+p]=h.y,f[v+2+p]=h.z,o&&(l=i.t.clone(c,l)),h=i.t.multiplyByScalar(u,t,h),h=i.t.add(l,h,h),f[v]=h.x,f[v+1]=h.y,f[v+2]=h.z;return e},m.polygonOutlinesFromHierarchy=function(e,t,n){var o,s,u,h=[],c=new d;for(c.enqueue(e);0!==c.length;){var l=c.dequeue(),f=l.positions;if(t)for(u=f.length,o=0;o<u;o++)n.scaleToGeodeticSurface(f[o],f[o]);if(!((f=r.D(f,i.t.equalsEpsilon,!0)).length<3)){var p=l.holes?l.holes.length:0;for(o=0;o<p;o++){var v=l.holes[o],g=v.positions;if(t)for(u=g.length,s=0;s<u;++s)n.scaleToGeodeticSurface(g[s],g[s]);if(!((g=r.D(g,i.t.equalsEpsilon,!0)).length<3)){h.push(g);var y=0;for(a.e(v.holes)&&(y=v.holes.length),s=0;s<y;s++)c.enqueue(v.holes[s])}}h.push(f)}}return h};var D=new i.t(6378137,6378137,6378137);m.polygonsFromHierarchy=function(e,t,n,o){var s=[],u=[],h=new d;for(h.enqueue(e);0!==h.length;){var c,l,f,v=h.dequeue(),m=v.positions,b=v.holes,I=m.slice();if(n)for(l=m.length,c=0;c<l;c++)o.scaleToGeodeticSurface(m[c],I[c]);if(a.e(o)&&!i.t.equals(o._radii,D)&&(f=p.e.EPSILON7),!((m=r.D(I,i.t.equalsEpsilon,!0,f)).length<3)){var w=t(m);if(a.e(w)){var _=[],L=g.A.computeWindingOrder2D(w);L===y.W.CLOCKWISE&&(w.reverse(),m=m.slice().reverse());var x,E=m.slice(),S=a.e(b)?b.length:0,T=[];for(c=0;c<S;c++){var A=b[c],C=A.positions;if(n)for(l=C.length,x=0;x<l;++x)o.scaleToGeodeticSurface(C[x],C[x]);if(!((C=r.D(C,i.t.equalsEpsilon,!0,p.e.EPSILON7)).length<3)){var N=t(C);if(a.e(N)){(L=g.A.computeWindingOrder2D(N))===y.W.CLOCKWISE&&(N.reverse(),C=C.slice().reverse()),T.push(C),_.push(E.length),E=E.concat(C),w=w.concat(N);var P=0;for(a.e(A.holes)&&(P=A.holes.length),x=0;x<P;x++)h.enqueue(A.holes[x])}}}s.push({outerRing:m,holes:T}),u.push({positions:E,positions2D:w,holes:_})}}}return{hierarchy:s,polygons:u}};var C=new n.o,N=new i.t,P=new h.n,G=new v.p;m.computeBoundingRectangle=function(e,t,r,n,o){for(var s=h.n.fromAxisAngle(e,n,P),u=v.p.fromQuaternion(s,G),c=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,g=r.length,y=0;y<g;++y){var d=i.t.clone(r[y],N);v.p.multiplyByVector(u,d,d);var m=t(d,C);a.e(m)&&(c=Math.min(c,m.x),l=Math.max(l,m.x),f=Math.min(f,m.y),p=Math.max(p,m.y))}return o.x=c,o.y=f,o.width=l-c,o.height=p-f,o},m.createGeometryFromPositions=function(e,r,n,i,a,s){var u=g.A.triangulate(r.positions2D,r.holes);u.length<3&&(u=[0,1,2]);var c=r.positions;if(i){for(var f=c.length,p=new Array(3*f),y=0,d=0;d<f;d++){var m=c[d];p[y++]=m.x,p[y++]=m.y,p[y++]=m.z}var b=new h.I({attributes:{position:new h.o({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p})},indices:u,primitiveType:v._0x102869.TRIANGLES});return a.normal?l.k.computeNormal(b):b}return s===t.L.GEODESIC?g.A.computeSubdivision(e,c,u,n):s===t.L.RHUMB?g.A.computeRhumbLineSubdivision(e,c,u,n):void 0};var O=[],M=new i.t,R=new i.t;m.computeWallGeometry=function(e,r,n,a,s,u){var l,g,y,d,b,I=u?1:0,w=e.length,_=0;if(a)for(g=3*(w-I)*2,l=new Array(2*g),y=0;y<w-I;y++)d=e[y],b=e[(y+1)%w],l[_]=l[_+g]=d.x,l[++_]=l[_+g]=d.y,l[++_]=l[_+g]=d.z,l[++_]=l[_+g]=b.x,l[++_]=l[_+g]=b.y,l[++_]=l[_+g]=b.z,++_;else{var L=p.e.chordLength(n,r.maximumRadius),x=0;if(s===t.L.GEODESIC)for(y=0;y<w;y++)x+=m.subdivideLineCount(e[y],e[(y+1)%w],L);else if(s===t.L.RHUMB)for(y=0;y<w;y++)x+=m.subdivideRhumbLineCount(r,e[y],e[(y+1)%w],L);for(g=3*(x+w),l=new Array(2*g),y=0;y<w;y++){var E;d=e[y],b=e[(y+1)%w],s===t.L.GEODESIC?E=m.subdivideLine(d,b,L,O):s===t.L.RHUMB&&(E=m.subdivideRhumbLine(r,d,b,L,O));for(var S=E.length,T=0;T<S;++T,++_)l[_]=E[T],l[_+g]=E[T];l[_]=b.x,l[_+g]=b.x,l[++_]=b.y,l[_+g]=b.y,l[++_]=b.z,l[_+g]=b.z,++_}}w=l.length;var A=f.IndexDatatype.createTypedArray(w/3,w-6*(e.length-I)),D=0;for(w/=6,y=0;y<w;y++){var C=y,N=C+1,P=C+w,G=P+1;d=i.t.fromArray(l,3*C,M),b=i.t.fromArray(l,3*N,R),!i.t.equalsEpsilon(d,b,p.e.EPSILON10,p.e.EPSILON10)&&(A[D++]=C,A[D++]=P,A[D++]=N,A[D++]=N,A[D++]=P,A[D++]=G)}return new h.I({attributes:new c.a({position:new h.o({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:l})}),indices:A,primitiveType:v._0x102869.TRIANGLES})},e.y=m}));
