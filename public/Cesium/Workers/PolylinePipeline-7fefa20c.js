define(["exports","./Cartographic-dafe811b","./when-207a1520","./Check-07c613bc","./Rectangle-49e286b5","./EllipsoidGeodesic-a38ba139","./EllipsoidRhumbLine-b1de3107","./IntersectionTests-37198421","./Math-bae672f2","./PrimitiveType-44685a19","./Plane-e266b3a4"],(function(e,t,r,a,n,i,o,c,s,u,h){"use strict";var l={numberOfPoints:function(e,r,a){var n=t.t.distance(e,r);return Math.ceil(n/a)},numberOfPointsRhumbLine:function(e,t,r){var a=Math.pow(e.longitude-t.longitude,2)+Math.pow(e.latitude-t.latitude,2);return Math.ceil(Math.sqrt(a/(r*r)))}},f=new t.t$1;l.extractHeights=function(e,t){for(var r=e.length,a=new Array(r),n=0;n<r;n++){var i=e[n];a[n]=t.cartesianToCartographic(i,f).height}return a};var g=new u.y,p=new t.t,v=new t.t,d=new h.o(t.t.UNIT_X,0),m=new t.t,w=new h.o(t.t.UNIT_X,0),y=new t.t,T=new t.t,P=[];function A(e,t,r){var a,n=P;if(n.length=e,t===r){for(a=0;a<e;a++)n[a]=t;return n}var i=(r-t)/e;for(a=0;a<e;a++){var o=t+a*i;n[a]=o}return n}var b=new t.t$1,C=new t.t$1,S=new t.t,R=new t.t,E=new t.t,D=new i.E,G=new o.P;function N(e,r,a,n,i,o,c,s,u){var h=n.scaleToGeodeticSurface(e,R),f=n.scaleToGeodeticSurface(r,E),g=l.numberOfPoints(e,r,a),p=n.cartesianToCartographic(h,b),v=n.cartesianToCartographic(f,C),d=A(g,i,o);u>0&&(d=function(e,t){var r=P;r.length=e;for(var a=0;a<e;a++)r[a]+=t*Math.sin(Math.PI*a/e);return r}(g,u)),D.setEndPoints(p,v);var m=D.surfaceDistance/g,w=s;p.height=i;var y=n.cartographicToCartesian(p,S);t.t.pack(y,c,w),w+=3;for(var T=1;T<g;T++){var G=D.interpolateUsingSurfaceDistance(T*m,C);G.height=d[T],y=n.cartographicToCartesian(G,S),t.t.pack(y,c,w),w+=3}return w}function I(e,r,a,n,i,c,s,u){var h=n.scaleToGeodeticSurface(e,R),f=n.scaleToGeodeticSurface(r,E),g=n.cartesianToCartographic(h,b),p=n.cartesianToCartographic(f,C),v=l.numberOfPointsRhumbLine(g,p,a),d=A(v,i,c);G.ellipsoid.equals(n)||(G=new o.P(void 0,void 0,n)),G.setEndPoints(g,p);var m=G.surfaceDistance/v,w=u;g.height=i;var y=n.cartographicToCartesian(g,S);t.t.pack(y,s,w),w+=3;for(var T=1;T<v;T++){var P=G.interpolateUsingSurfaceDistance(T*m,C);P.height=d[T],y=n.cartographicToCartesian(P,S),t.t.pack(y,s,w),w+=3}return w}l.wrapLongitude=function(e,a){var n=[],i=[];if(r.e(e)&&e.length>0){a=r.u(a,u.y.IDENTITY);var o=u.y.inverseTransformation(a,g),s=u.y.multiplyByPoint(o,t.t.ZERO,p),l=t.t.normalize(u.y.multiplyByPointAsVector(o,t.t.UNIT_Y,v),v),f=h.o.fromPointNormal(s,l,d),P=t.t.normalize(u.y.multiplyByPointAsVector(o,t.t.UNIT_X,m),m),A=h.o.fromPointNormal(s,P,w),b=1;n.push(t.t.clone(e[0]));for(var C=n[0],S=e.length,R=1;R<S;++R){var E=e[R];if(h.o.getPointDistance(A,C)<0||h.o.getPointDistance(A,E)<0){var D=c.g.lineSegmentPlane(C,E,f,y);if(r.e(D)){var G=t.t.multiplyByScalar(l,5e-9,T);h.o.getPointDistance(f,C)<0&&t.t.negate(G,G),n.push(t.t.add(D,G,new t.t)),i.push(b+1),t.t.negate(G,G),n.push(t.t.add(D,G,new t.t)),b=1}}n.push(t.t.clone(e[R])),b++,C=E}i.push(b)}return{positions:n,lengths:i}},l.generateArc=function(e){r.e(e)||(e={});var i=e.positions;if(!r.e(i))throw new a.t("options.positions is required.");var o=i.length,c=r.u(e.ellipsoid,n.t.WGS84),u=r.u(e.height,0),h=Array.isArray(u);if(o<1)return[];if(1===o){var f=c.scaleToGeodeticSurface(i[0],R);if(0!==(u=h?u[0]:u)){var g=c.geodeticSurfaceNormal(f,S);t.t.multiplyByScalar(g,u,g),t.t.add(f,g,f)}return[f.x,f.y,f.z]}var p=e.minDistance;if(!r.e(p)){var v=r.u(e.granularity,s.e.RADIANS_PER_DEGREE);p=s.e.chordLength(v,c.maximumRadius)}var d,m=0;for(d=0;d<o-1;d++)m+=l.numberOfPoints(i[d],i[d+1],p);var w=e.hMax,y=3*(m+1),T=new Array(y),A=0;for(d=0;d<o-1;d++){A=N(i[d],i[d+1],p,c,h?u[d]:u,h?u[d+1]:u,T,A,w)}P.length=0;var C=i[o-1],E=c.cartesianToCartographic(C,b);E.height=h?u[o-1]:u;var D=c.cartographicToCartesian(E,S);return t.t.pack(D,T,y-3),T};var k=new t.t$1,M=new t.t$1;l.generateRhumbArc=function(e){r.e(e)||(e={});var i=e.positions;if(!r.e(i))throw new a.t("options.positions is required.");var o=i.length,c=r.u(e.ellipsoid,n.t.WGS84),u=r.u(e.height,0),h=Array.isArray(u);if(o<1)return[];if(1===o){var f=c.scaleToGeodeticSurface(i[0],R);if(0!==(u=h?u[0]:u)){var g=c.geodeticSurfaceNormal(f,S);t.t.multiplyByScalar(g,u,g),t.t.add(f,g,f)}return[f.x,f.y,f.z]}var p,v,d=r.u(e.granularity,s.e.RADIANS_PER_DEGREE),m=0,w=c.cartesianToCartographic(i[0],k);for(p=0;p<o-1;p++)v=c.cartesianToCartographic(i[p+1],M),m+=l.numberOfPointsRhumbLine(w,v,d),w=t.t$1.clone(v,k);var y=3*(m+1),T=new Array(y),A=0;for(p=0;p<o-1;p++){A=I(i[p],i[p+1],d,c,h?u[p]:u,h?u[p+1]:u,T,A)}P.length=0;var C=i[o-1],E=c.cartesianToCartographic(C,b);E.height=h?u[o-1]:u;var D=c.cartographicToCartesian(E,S);return t.t.pack(D,T,y-3),T},l.generateCartesianArc=function(e){for(var r=l.generateArc(e),a=r.length/3,n=new Array(a),i=0;i<a;i++)n[i]=t.t.unpack(r,3*i);return n},l.generateCartesianRhumbArc=function(e){for(var r=l.generateRhumbArc(e),a=r.length/3,n=new Array(a),i=0;i<a;i++)n[i]=t.t.unpack(r,3*i);return n},e.m=l}));
