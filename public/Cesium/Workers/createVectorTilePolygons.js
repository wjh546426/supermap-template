define(["./AttributeCompression-f9972ce8","./Cartographic-dafe811b","./Color-03dac52c","./when-207a1520","./Rectangle-49e286b5","./IndexDatatype-447558fc","./Math-bae672f2","./OrientedBoundingBox-dd9541f0","./createTaskProcessorWorker","./Cartesian2-4a5e3b0e","./Check-07c613bc","./FeatureDetection-fc084259","./WebGLConstants-8d1e45f7","./buildModuleUrl-c881a5f0","./Intersect-4d67bbf5","./PrimitiveType-44685a19","./Cartesian4-58d59766","./RuntimeError-b98f87df","./Event-2ef149d9","./EllipsoidTangentPlane-fb04e18c","./IntersectionTests-37198421","./Plane-e266b3a4","./GeometryAttribute-9a541822","./PolygonPipeline-63f52c70","./WindingOrder-380ced54","./ComponentDatatype-662c7548","./EllipsoidRhumbLine-b1de3107","./Buffer-bf3c9fbe","./RenderState-f1428610","./BoundingRectangle-beed7718"],(function(e,t,r,n,a,i,o,f,c,s,d,u,h,l,b,p,g,y,v,I,m,w,x,A,N,T,k,E,L,P){"use strict";var C=new t.t,O=new a.t,U=new a.h,B={min:void 0,max:void 0,indexBytesPerElement:void 0};function F(e,t,n){var a=t.length,i=2+a*f.x.packedLength+1+function(e){for(var t=e.length,n=0,a=0;a<t;++a)n+=r.e.packedLength+3+e[a].batchIds.length;return n}(n),o=new Float64Array(i),c=0;o[c++]=e,o[c++]=a;for(var s=0;s<a;++s)f.x.pack(t[s],o,c),c+=f.x.packedLength;var d=n.length;o[c++]=d;for(var u=0;u<d;++u){var h=n[u];r.e.pack(h.color,o,c),c+=r.e.packedLength,o[c++]=h.offset,o[c++]=h.count;var l=h.batchIds,b=l.length;o[c++]=b;for(var p=0;p<b;++p)o[c++]=l[p]}return o}var S=new t.t,D=new t.t,R=new t.t,_=new t.t,G=new t.t,M=new t.t$1,Y=new a.h;return c((function(c,s){var d;!function(e){var r=new Float64Array(e),n=0;B.indexBytesPerElement=r[n++],B.min=r[n++],B.max=r[n++],t.t.unpack(r,n,C),n+=t.t.packedLength,a.t.unpack(r,n,O),n+=a.t.packedLength,a.h.unpack(r,n,U)}(c.packedBuffer),d=2===B.indexBytesPerElement?new Uint16Array(c.indices):new Uint32Array(c.indices);var u,h,l,b=new Uint16Array(c.positions),p=new Uint32Array(c.counts),g=new Uint32Array(c.indexCounts),y=new Uint32Array(c.batchIds),v=new Uint32Array(c.batchTableColors),I=new Array(p.length),m=C,w=O,x=U,A=B.min,N=B.max,T=c.minimumHeights,k=c.maximumHeights;n.e(T)&&n.e(k)&&(T=new Float32Array(T),k=new Float32Array(k));var E=b.length/2,L=b.subarray(0,E),P=b.subarray(E,2*E);e.t.zigZagDeltaDecode(L,P);var V=new Float32Array(3*E);for(u=0;u<E;++u){var H=L[u],W=P[u],$=o.e.lerp(x.west,x.east,H/32767),z=o.e.lerp(x.south,x.north,W/32767),Z=t.t$1.fromRadians($,z,0,M),j=w.cartographicToCartesian(Z,S);t.t.pack(j,V,3*u)}var q=p.length,J=new Array(q),K=new Array(q),Q=0,X=0;for(u=0;u<q;++u)J[u]=Q,K[u]=X,Q+=p[u],X+=g[u];var ee,te=new Float32Array(3*E*2),re=new Uint16Array(2*E),ne=new Uint32Array(K.length),ae=new Uint32Array(g.length),ie=[],oe={};for(u=0;u<q;++u)l=v[u],n.e(oe[l])?(oe[l].positionLength+=p[u],oe[l].indexLength+=g[u],oe[l].batchIds.push(u)):oe[l]={positionLength:p[u],indexLength:g[u],offset:0,indexOffset:0,batchIds:[u]};var fe=0,ce=0;for(l in oe)if(oe.hasOwnProperty(l)){(ee=oe[l]).offset=fe,ee.indexOffset=ce;var se=2*ee.positionLength,de=2*ee.indexLength+6*ee.positionLength;fe+=se,ce+=de,ee.indexLength=de}var ue=[];for(l in oe)oe.hasOwnProperty(l)&&(ee=oe[l],ue.push({color:r.e.fromRgba(parseInt(l)),offset:ee.indexOffset,count:ee.indexLength,batchIds:ee.batchIds}));for(u=0;u<q;++u){var he=(ee=oe[l=v[u]]).offset,le=3*he,be=he,pe=J[u],ge=p[u],ye=y[u],ve=A,Ie=N;n.e(T)&&n.e(k)&&(ve=T[u],Ie=k[u]);var me=Number.POSITIVE_INFINITY,we=Number.NEGATIVE_INFINITY,xe=Number.POSITIVE_INFINITY,Ae=Number.NEGATIVE_INFINITY;for(h=0;h<ge;++h){var Ne=t.t.unpack(V,3*pe+3*h,S);w.scaleToGeodeticSurface(Ne,Ne);var Te=w.cartesianToCartographic(Ne,M),ke=Te.latitude,Ee=Te.longitude;me=Math.min(ke,me),we=Math.max(ke,we),xe=Math.min(Ee,xe),Ae=Math.max(Ee,Ae);var Le=w.geodeticSurfaceNormal(Ne,D),Pe=t.t.multiplyByScalar(Le,ve,R),Ce=t.t.add(Ne,Pe,_);Pe=t.t.multiplyByScalar(Le,Ie,Pe);var Oe=t.t.add(Ne,Pe,G);t.t.subtract(Oe,m,Oe),t.t.subtract(Ce,m,Ce),t.t.pack(Oe,te,le),t.t.pack(Ce,te,le+3),re[be]=ye,re[be+1]=ye,le+=6,be+=2}(x=Y).west=xe,x.east=Ae,x.south=me,x.north=we,I[u]=f.x.fromRectangle(x,A,N,w);var Ue=ee.indexOffset,Be=K[u],Fe=g[u];for(ne[u]=Ue,h=0;h<Fe;h+=3){var Se=d[Be+h]-pe,De=d[Be+h+1]-pe,Re=d[Be+h+2]-pe;ie[Ue++]=2*Se+he,ie[Ue++]=2*De+he,ie[Ue++]=2*Re+he,ie[Ue++]=2*Re+1+he,ie[Ue++]=2*De+1+he,ie[Ue++]=2*Se+1+he}for(h=0;h<ge;++h){var _e=h,Ge=(h+1)%ge;ie[Ue++]=2*_e+1+he,ie[Ue++]=2*Ge+he,ie[Ue++]=2*_e+he,ie[Ue++]=2*_e+1+he,ie[Ue++]=2*Ge+1+he,ie[Ue++]=2*Ge+he}ee.offset+=2*ge,ee.indexOffset=Ue,ae[u]=Ue-ne[u]}ie=i.IndexDatatype.createTypedArray(te.length/3,ie);for(var Me=ue.length,Ye=0;Ye<Me;++Ye){for(var Ve=ue[Ye].batchIds,He=0,We=Ve.length,$e=0;$e<We;++$e)He+=ae[Ve[$e]];ue[Ye].count=He}var ze=F(2===ie.BYTES_PER_ELEMENT?i.IndexDatatype.UNSIGNED_SHORT:i.IndexDatatype.UNSIGNED_INT,I,ue);return s.push(te.buffer,ie.buffer,ne.buffer,ae.buffer,re.buffer,ze.buffer),{positions:te.buffer,indices:ie.buffer,indexOffsets:ne.buffer,indexCounts:ae.buffer,batchIds:re.buffer,packedBuffer:ze.buffer}}))}));
