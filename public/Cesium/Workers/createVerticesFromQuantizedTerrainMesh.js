define(["./AttributeCompression-f9972ce8","./EllipsoidTangentPlane-fb04e18c","./buildModuleUrl-c881a5f0","./Cartesian2-4a5e3b0e","./Cartographic-dafe811b","./when-207a1520","./Rectangle-49e286b5","./TerrainEncoding-d5db3c72","./IndexDatatype-447558fc","./Math-bae672f2","./PrimitiveType-44685a19","./OrientedBoundingBox-dd9541f0","./Check-07c613bc","./GeometryAttribute-9a541822","./WebMercatorProjection-d4a65be8","./createTaskProcessorWorker","./Intersect-4d67bbf5","./Cartesian4-58d59766","./IntersectionTests-37198421","./Plane-e266b3a4","./Event-2ef149d9","./RuntimeError-b98f87df","./ComponentDatatype-662c7548","./WebGLConstants-8d1e45f7","./PolygonPipeline-63f52c70","./WindingOrder-380ced54","./EllipsoidRhumbLine-b1de3107","./Buffer-bf3c9fbe","./RenderState-f1428610","./BoundingRectangle-beed7718","./Color-03dac52c","./FeatureDetection-fc084259"],(function(e,t,r,n,i,o,a,s,h,d,c,u,l,I,m,g,f,T,y,v,w,E,p,b,N,S,A,x,P,_,F,M){"use strict";function B(){l.t.throwInstantiationError()}Object.defineProperties(B.prototype,{errorEvent:{get:l.t.throwInstantiationError},credit:{get:l.t.throwInstantiationError},tilingScheme:{get:l.t.throwInstantiationError},ready:{get:l.t.throwInstantiationError},readyPromise:{get:l.t.throwInstantiationError},hasWaterMask:{get:l.t.throwInstantiationError},hasVertexNormals:{get:l.t.throwInstantiationError},availability:{get:l.t.throwInstantiationError}});var G=[];B.getRegularGridIndices=function(e,t){if(e*t>=d.e.FOUR_GIGABYTES)throw new l.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=G[e];o.e(r)||(G[e]=r=[]);var n=r[t];return o.e(n)||C(e,t,n=e*t<d.e.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),n},B.getRegularGridIndicesForReproject=function(e,t){if(e*t>=d.e.FOUR_GIGABYTES)throw new l.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=G[e];o.e(r)||(G[e]=r=[]);var n=r[t];return o.e(n)||C(e,t,n=e*t<d.e.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var W=[];B.getRegularGridIndicesAndEdgeIndices=function(e,t){if(e*t>=d.e.FOUR_GIGABYTES)throw new l.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=W[e];o.e(r)||(W[e]=r=[]);var n=r[t];if(!o.e(n)){var i=B.getRegularGridIndices(e,t),a=R(e,t),s=a.westIndicesSouthToNorth,h=a.southIndicesEastToWest,c=a.eastIndicesNorthToSouth,u=a.northIndicesWestToEast;n=r[t]={indices:i,westIndicesSouthToNorth:s,southIndicesEastToWest:h,eastIndicesNorthToSouth:c,northIndicesWestToEast:u}}return n};var O=[];function R(e,t){var r,n=new Array(t),i=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,i[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,n[r]=(t-r-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function C(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,h=s+e,d=h+1,c=s+1;r[n++]=s,r[n++]=h,r[n++]=c,r[n++]=c,r[n++]=h,r[n++]=d,++i}++i}var u=(t-1)/2,l=(e-1)/2;i=0;for(a=0;a<l;a++)r[n++]=i,r[n++]=i+1,r[n++]=i+2,i+=2;i=e*(t-1);for(a=0;a<l;a++)r[n++]=i+1,r[n++]=i,r[n++]=i+2,i+=2;i=0;for(a=0;a<u;a++)r[n++]=i+e,r[n++]=i,r[n++]=i+2*e,i+=2*e;i=e-1;for(a=0;a<u;a++)r[n++]=i,r[n++]=i+e,r[n++]=i+2*e,i+=2*e}function Y(e,t,r,n,i){for(var a=o.e(i),s=e[0],h=e.length,d=1;d<h;++d){var c=e[d];!a||i[s+"_"+c]?(r[n++]=s,r[n++]=c,r[n++]=t,r[n++]=t,r[n++]=c,r[n++]=t+1,s=c,++t):(s=c,++t)}return n}B.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){if(e*t>=d.e.FOUR_GIGABYTES)throw new l.t("The total number of vertices (width * height) must be less than 4,294,967,296.");var r=O[e];o.e(r)||(O[e]=r=[]);var n=r[t];if(!o.e(n)){var i=e*t,a=(e-1)*(t-1)*6,s=2*e+2*t,c=i+s,u=3*(e+t-2),I=a+6*Math.max(0,s-4)+u,m=R(e,t),g=m.westIndicesSouthToNorth,f=m.southIndicesEastToWest,T=m.eastIndicesNorthToSouth,y=m.northIndicesWestToEast,v=h.IndexDatatype.createTypedArray(c,I);C(e,t,v,0),B.addSkirtIndices(g,f,T,y,i,v,a+u),n=r[t]={indices:v,westIndicesSouthToNorth:g,southIndicesEastToWest:f,eastIndicesNorthToSouth:T,northIndicesWestToEast:y,indexCountWithoutSkirts:a}}return n},B.addSkirtIndices=function(e,t,r,n,i,o,a,s){var h=i;a=Y(e,h,o,a,s),a=Y(t,h+=e.length,o,a,s),a=Y(r,h+=t.length,o,a,s),Y(n,h+=r.length,o,a,s)},B.heightmapTerrainQuality=.25,B.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*B.heightmapTerrainQuality/(t*r)},B.prototype.requestTileGeometry=l.t.throwInstantiationError,B.prototype.getLevelMaximumGeometricError=l.t.throwInstantiationError,B.prototype.getTileDataAvailable=l.t.throwInstantiationError,B.prototype.loadTileDataAvailability=l.t.throwInstantiationError;var k=32767,H=new i.t,V=new i.t,U=new i.t,z=new i.t$1,L=new n.o,D=new i.t,j=new c.y,q=new c.y;function K(e,t,r,n,o,a,s,h,u){var l=Number.POSITIVE_INFINITY,I=o.north,m=o.south,g=o.east,f=o.west;g<f&&(g+=d.e.TWO_PI);for(var T=e.length,y=0;y<T;++y){var v=e[y],w=r[v],E=n[v];z.longitude=d.e.lerp(f,g,E.x),z.latitude=d.e.lerp(m,I,E.y),z.height=w-t;var p=a.cartographicToCartesian(z,H);c.y.multiplyByPoint(s,p,p),i.t.minimumByComponent(p,h,h),i.t.maximumByComponent(p,u,u),l=Math.min(l,z.height)}return l}function Q(t,r,n,a,s,h,u,l,g,f,T,y,v,w,E){var p=o.e(u),b=g.north,N=g.south,S=g.east,A=g.west;S<A&&(S+=d.e.TWO_PI);for(var x=n.length,P=0;P<x;++P){var _=n[P],F=s[_],M=h[_];z.longitude=d.e.lerp(A,S,M.x)+w,z.latitude=d.e.lerp(N,b,M.y)+E,z.height=F-f;var B,G=l.cartographicToCartesian(z,H);if(p){var W=2*_;if(L.x=u[W],L.y=u[W+1],1!==T){var O=e.t.octDecode(L.x,L.y,D),R=I.m.eastNorthUpToFixedFrame(H,l,q),C=c.y.inverseTransformation(R,j);c.y.multiplyByPointAsVector(C,O,O),O.z*=T,i.t.normalize(O,O),c.y.multiplyByPointAsVector(R,O,O),i.t.normalize(O,O),e.t.octEncode(O,L)}}a.hasWebMercatorT&&(B=(m.t.geodeticLatitudeToMercatorAngle(z.latitude)-y)*v),r=a.encode(t,r,G,M,z.height,L,B)}}function X(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),o.e(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}var Z=g((function(l,g){var f,T,y=l.quantizedVertices,v=y.length/3,w=l.octEncodedNormals,E=l.westIndices.length+l.eastIndices.length+l.southIndices.length+l.northIndices.length,p=l.includeWebMercatorT,b=a.h.clone(l.rectangle),N=b.west,S=b.south,A=b.east,x=b.north,P=a.t.clone(l.ellipsoid),_=l.exaggeration,F=l.minimumHeight*_,M=l.maximumHeight*_,G=o.e(l.validMinimumHeight)?l.validMinimumHeight*_:F*_,W=o.e(l.validMaximumHeight)?l.validMaximumHeight*_:M*_,O=l.relativeToCenter,R=I.m.eastNorthUpToFixedFrame(O,P),C=c.y.inverseTransformation(R,new c.y);p&&(f=m.t.geodeticLatitudeToMercatorAngle(S),T=1/(m.t.geodeticLatitudeToMercatorAngle(x)-f));var Y=y.subarray(0,v),Z=y.subarray(v,2*v),$=y.subarray(2*v,3*v),J=o.e(w),ee=new Array(v),te=new Array(v),re=new Array(v),ne=p?new Array(v):[],ie=V;ie.x=Number.POSITIVE_INFINITY,ie.y=Number.POSITIVE_INFINITY,ie.z=Number.POSITIVE_INFINITY;var oe=U;oe.x=Number.NEGATIVE_INFINITY,oe.y=Number.NEGATIVE_INFINITY,oe.z=Number.NEGATIVE_INFINITY;for(var ae=Number.POSITIVE_INFINITY,se=Number.NEGATIVE_INFINITY,he=Number.POSITIVE_INFINITY,de=Number.NEGATIVE_INFINITY,ce=0;ce<v;++ce){var ue=Y[ce],le=Z[ce],Ie=ue/k,me=le/k,ge=d.e.lerp(F,M,$[ce]/k);z.longitude=d.e.lerp(N,A,Ie),z.latitude=d.e.lerp(S,x,me),z.height=ge,ae=Math.min(z.longitude,ae),se=Math.max(z.longitude,se),he=Math.min(z.latitude,he),de=Math.max(z.latitude,de);var fe=P.cartographicToCartesian(z);ee[ce]=new n.o(Ie,me),te[ce]=ge,re[ce]=fe,p&&(ne[ce]=(m.t.geodeticLatitudeToMercatorAngle(z.latitude)-f)*T),c.y.multiplyByPoint(C,fe,H),i.t.minimumByComponent(H,ie,ie),i.t.maximumByComponent(H,oe,oe)}var Te,ye,ve=X(l.westIndices,(function(e,t){return ee[e].y-ee[t].y})),we=X(l.eastIndices,(function(e,t){return ee[t].y-ee[e].y})),Ee=X(l.southIndices,(function(e,t){return ee[t].x-ee[e].x})),pe=X(l.northIndices,(function(e,t){return ee[e].x-ee[t].x}));ye=r.i.fromPoints(re),Te=u.x.fromRectangle(b,F,M,P);var be,Ne=u.x.fromRectangle(b,G,W,P);(1!==_||F<0)&&(be=new s.s(P).computeHorizonCullingPointPossiblyUnderEllipsoid(O,re,F));var Se=F;Se=Math.min(Se,K(l.westIndices,l.westSkirtHeight,te,ee,b,P,C,ie,oe)),Se=Math.min(Se,K(l.southIndices,l.southSkirtHeight,te,ee,b,P,C,ie,oe)),Se=Math.min(Se,K(l.eastIndices,l.eastSkirtHeight,te,ee,b,P,C,ie,oe)),Se=Math.min(Se,K(l.northIndices,l.northSkirtHeight,te,ee,b,P,C,ie,oe));for(var Ae=new t.e(ie,oe,O),xe=new s.h(Ae,Se,M,R,J,p),Pe=xe.getStride(),_e=new Float32Array(v*Pe+E*Pe),Fe=0,Me=0;Me<v;++Me){if(J){var Be=2*Me;if(L.x=w[Be],L.y=w[Be+1],1!==_){var Ge=e.t.octDecode(L.x,L.y,D),We=I.m.eastNorthUpToFixedFrame(re[Me],P,q),Oe=c.y.inverseTransformation(We,j);c.y.multiplyByPointAsVector(Oe,Ge,Ge),Ge.z*=_,i.t.normalize(Ge,Ge),c.y.multiplyByPointAsVector(We,Ge,Ge),i.t.normalize(Ge,Ge),e.t.octEncode(Ge,L)}}Fe=xe.encode(_e,Fe,re[Me],ee[Me],te[Me],L,ne[Me])}var Re=Math.max(0,2*(E-4)),Ce=l.indices.length+3*Re,Ye=h.IndexDatatype.createTypedArray(v+E,Ce);Ye.set(l.indices,0);var ke=1e-4,He=(se-ae)*ke,Ve=(de-he)*ke,Ue=-He,ze=He,Le=Ve,De=-Ve,je=v*Pe;Q(_e,je,ve,xe,te,ee,w,P,b,l.westSkirtHeight,_,f,T,Ue,0),Q(_e,je+=l.westIndices.length*Pe,Ee,xe,te,ee,w,P,b,l.southSkirtHeight,_,f,T,0,De),Q(_e,je+=l.southIndices.length*Pe,we,xe,te,ee,w,P,b,l.eastSkirtHeight,_,f,T,ze,0),Q(_e,je+=l.eastIndices.length*Pe,pe,xe,te,ee,w,P,b,l.northSkirtHeight,_,f,T,0,Le);var qe=function(e,t,r,n){if(n<12)return;for(var i={},o=e.length,a=0;a<o;a+=3){var s=e[a],h=e[a+1],d=e[a+2];(t[s]===k&&t[h]===k||0===t[s]&&0===t[h]||r[s]===k&&r[h]===k||0===r[s]&&0===r[h])&&(i[s+"_"+h]=1,i[h+"_"+s]=1),(t[h]===k&&t[d]===k||0===t[h]&&0===t[d]||r[h]===k&&r[d]===k||0===r[h]&&0===r[d])&&(i[h+"_"+d]=1,i[d+"_"+h]=1),(t[d]===k&&t[s]===k||0===t[d]&&0===t[s]||r[d]===k&&r[s]===k||0===r[d]&&0===r[s])&&(i[d+"_"+s]=1,i[s+"_"+d]=1)}return i}(l.indices,Y,Z,l.level);return B.addSkirtIndices(ve,Ee,we,pe,v,Ye,l.indices.length,qe),g.push(_e.buffer,Ye.buffer),{vertices:_e.buffer,indices:Ye.buffer,westIndicesSouthToNorth:ve,southIndicesEastToWest:Ee,eastIndicesNorthToSouth:we,northIndicesWestToEast:pe,vertexStride:Pe,center:O,minimumHeight:F,maximumHeight:M,boundingSphere:ye,orientedBoundingBox:Te,validOrientedBoundingBox:Ne,occludeePointInScaledSpace:be,encoding:xe,indexCountWithoutSkirts:l.indices.length}}));return Z}));
