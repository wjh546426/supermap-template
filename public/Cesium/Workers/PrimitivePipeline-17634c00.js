define(["exports","./buildModuleUrl-c881a5f0","./ComponentDatatype-662c7548","./when-207a1520","./Check-07c613bc","./Rectangle-49e286b5","./Intersect-4d67bbf5","./GeometryAttribute-9a541822","./GeometryAttributes-d4cebc09","./GeometryPipeline-35f216f8","./IndexDatatype-447558fc","./PrimitiveType-44685a19","./WebMercatorProjection-d4a65be8"],(function(e,t,r,n,o,i,a,s,c,p,u,f,m){"use strict";function d(e,t,r){e=n.u(e,0),t=n.u(t,0),r=n.u(r,0),this.value=new Float32Array([e,t,r])}function h(e,t){var n=e.attributes,o=n.position,i=o.values.length/o.componentsPerAttribute;n.batchId=new s.o({componentDatatype:r.ComponentDatatype.FLOAT,componentsPerAttribute:1,values:new Float32Array(i)});for(var a=n.batchId.values,c=0;c<i;++c)a[c]=t}function l(e){var i,a,s,c=e.instances,u=e.projection,m=e.elementIndexUintSupported,d=e.scene3DOnly,l=e.vertexCacheOptimize,g=e.compressVertices,y=e.modelMatrix,v=c.length;for(i=0;i<v;++i)if(n.e(c[i].geometry)){s=c[i].geometry.primitiveType;break}for(i=1;i<v;++i)if(n.e(c[i].geometry)&&c[i].geometry.primitiveType!==s)throw new o.t("All instance geometries must have the same primitiveType.");if(function(e,t,r){var o,i=!r,a=e.length;if(!i&&a>1){var s=e[0].modelMatrix;for(o=1;o<a;++o)if(!f.y.equals(s,e[o].modelMatrix)){i=!0;break}}if(i)for(o=0;o<a;++o)n.e(e[o].geometry)&&p.k.transformToWorldCoordinates(e[o]);else f.y.multiplyTransformation(t,e[0].modelMatrix,t)}(c,y,d),!d)for(i=0;i<v;++i)n.e(c[i].geometry)&&p.k.splitLongitude(c[i]);if(function(e){for(var t=e.length,r=0;r<t;++r){var o=e[r];n.e(o.geometry)?h(o.geometry,r):n.e(o.westHemisphereGeometry)&&n.e(o.eastHemisphereGeometry)&&(h(o.westHemisphereGeometry,r),h(o.eastHemisphereGeometry,r))}}(c),l)for(i=0;i<v;++i){var b=c[i];n.e(b.geometry)?(p.k.reorderForPostVertexCache(b.geometry),p.k.reorderForPreVertexCache(b.geometry)):n.e(b.westHemisphereGeometry)&&n.e(b.eastHemisphereGeometry)&&(p.k.reorderForPostVertexCache(b.westHemisphereGeometry),p.k.reorderForPreVertexCache(b.westHemisphereGeometry),p.k.reorderForPostVertexCache(b.eastHemisphereGeometry),p.k.reorderForPreVertexCache(b.eastHemisphereGeometry))}var k=p.k.combineInstances(c);for(v=k.length,i=0;i<v;++i){var x,C=(a=k[i]).attributes;if(d)for(x in C)C.hasOwnProperty(x)&&C[x].componentDatatype===r.ComponentDatatype.DOUBLE&&p.k.encodeAttribute(a,x,x+"3DHigh",x+"3DLow");else for(x in C)if(C.hasOwnProperty(x)&&C[x].componentDatatype===r.ComponentDatatype.DOUBLE){var w=x+"3D",S=x+"2D";p.k.projectTo2D(a,x,w,S,u),n.e(a.boundingSphere)&&"position"===x&&(a.boundingSphereCV=t.i.fromVertices(a.attributes.position2D.values)),p.k.encodeAttribute(a,w,w+"High",w+"Low"),p.k.encodeAttribute(a,S,S+"High",S+"Low")}g&&p.k.compressVertices(a)}if(!m){var A=[];for(v=k.length,i=0;i<v;++i)a=k[i],A=A.concat(p.k.fitToUnsignedShortIndices(a));k=A}return k}function g(e,t,r,o){var i,a,s,c=o.length-1;if(c>=0){var p=o[c];i=p.offset+p.count,a=r[s=p.index].indices.length}else i=0,a=r[s=0].indices.length;for(var u=e.length,f=0;f<u;++f){var m=e[f][t];if(n.e(m)){var d=m.indices.length;i+d>a&&(i=0,a=r[++s].indices.length),o.push({index:s,offset:i,count:d}),i+=d}}}Object.defineProperties(d.prototype,{componentDatatype:{get:function(){return r.ComponentDatatype.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}}),d.fromCartesian3=function(e){return o.o.defined("offset",e),new d(e.x,e.y,e.z)},d.toValue=function(e,t){return o.o.defined("offset",e),n.e(t)||(t=new Float32Array([e.x,e.y,e.z])),t[0]=e.x,t[1]=e.y,t[2]=e.z,t};var y={};function v(e,t){var r=e.attributes;for(var o in r)if(r.hasOwnProperty(o)){var i=r[o];n.e(i)&&n.e(i.values)&&t.push(i.values.buffer)}n.e(e.indices)&&t.push(e.indices.buffer)}function b(e,t){var r=e.length,o=new Float64Array(1+19*r),i=0;o[i++]=r;for(var a=0;a<r;a++){var s=e[a];if(f.y.pack(s.modelMatrix,o,i),i+=f.y.packedLength,n.e(s.attributes)&&n.e(s.attributes.offset)){var c=s.attributes.offset.value;o[i]=c[0],o[i+1]=c[1],o[i+2]=c[2]}i+=3}return t.push(o.buffer),o}function k(e){for(var t=e,r=new Array(t[0]),o=0,i=1;i<t.length;){var a,s=f.y.unpack(t,i);i+=f.y.packedLength,n.e(t[i])&&(a={offset:new d(t[i],t[i+1],t[i+2])}),i+=3,r[o++]={modelMatrix:s,attributes:a}}return r}function x(e){var r=e.length,o=1+(t.i.packedLength+1)*r,i=new Float32Array(o),a=0;i[a++]=r;for(var s=0;s<r;++s){var c=e[s];n.e(c)?(i[a++]=1,t.i.pack(e[s],i,a)):i[a++]=0,a+=t.i.packedLength}return i}function C(e){for(var r=new Array(e[0]),n=0,o=1;o<e.length;)1===e[o++]&&(r[n]=t.i.unpack(e,o)),++n,o+=t.i.packedLength;return r}y.combineGeometry=function(e){var r,o,i,a,s=e.instances,c=s.length,u=!1;c>0&&((r=l(e)).length>0&&(o=p.k.createAttributeLocations(r[0]),e.createPickOffsets&&(i=function(e,t){var r=[];return g(e,"geometry",t,r),g(e,"westHemisphereGeometry",t,r),g(e,"eastHemisphereGeometry",t,r),r}(s,r))),n.e(s[0].attributes)&&n.e(s[0].attributes.offset)&&(a=new Array(c),u=!0));for(var f=new Array(c),m=new Array(c),d=0;d<c;++d){var h=s[d],y=h.geometry;n.e(y)&&(f[d]=y.boundingSphere,m[d]=y.boundingSphereCV,u&&(a[d]=h.geometry.offsetAttribute));var v=h.eastHemisphereGeometry,b=h.westHemisphereGeometry;n.e(v)&&n.e(b)&&(n.e(v.boundingSphere)&&n.e(b.boundingSphere)&&(f[d]=t.i.union(v.boundingSphere,b.boundingSphere)),n.e(v.boundingSphereCV)&&n.e(b.boundingSphereCV)&&(m[d]=t.i.union(v.boundingSphereCV,b.boundingSphereCV)))}return{geometries:r,modelMatrix:e.modelMatrix,attributeLocations:o,pickOffsets:i,offsetInstanceExtend:a,boundingSpheres:f,boundingSpheresCV:m}},y.packCreateGeometryResults=function(e,r){var o=new Float64Array(function(e){for(var r=1,o=e.length,i=0;i<o;i++){var a=e[i];if(++r,n.e(a)){var s=a.attributes;for(var c in r+=7+2*t.i.packedLength+(n.e(a.indices)?a.indices.length:0),s)s.hasOwnProperty(c)&&n.e(s[c])&&(r+=6+s[c].values.length)}}return r}(e)),i=[],a={},s=e.length,c=0;o[c++]=s;for(var p=0;p<s;p++){var u=e[p],f=n.e(u);if(o[c++]=f?1:0,f){o[c++]=u.primitiveType,o[c++]=u.geometryType,o[c++]=n.u(u.offsetAttribute,-1);var m=n.e(u.boundingSphere)?1:0;o[c++]=m,m&&t.i.pack(u.boundingSphere,o,c),c+=t.i.packedLength;var d=n.e(u.boundingSphereCV)?1:0;o[c++]=d,d&&t.i.pack(u.boundingSphereCV,o,c),c+=t.i.packedLength;var h=u.attributes,l=[];for(var g in h)h.hasOwnProperty(g)&&n.e(h[g])&&(l.push(g),n.e(a[g])||(a[g]=i.length,i.push(g)));o[c++]=l.length;for(var y=0;y<l.length;y++){var v=l[y],b=h[v];o[c++]=a[v],o[c++]=b.componentDatatype,o[c++]=b.componentsPerAttribute,o[c++]=b.normalize?1:0,o[c++]=b.isInstanceAttribute?1:0,o[c++]=b.values.length,o.set(b.values,c),c+=b.values.length}var k=n.e(u.indices)?u.indices.length:0;o[c++]=k,k>0&&(o.set(u.indices,c),c+=k)}}return r.push(o.buffer),{stringTable:i,packedData:o}},y.unpackCreateGeometryResults=function(e){for(var n,o=e.stringTable,i=e.packedData,a=new Array(i[0]),p=0,f=1;f<i.length;){if(1===i[f++]){var m,d,h=i[f++],l=i[f++],g=i[f++];-1===g&&(g=void 0),1===i[f++]&&(m=t.i.unpack(i,f)),f+=t.i.packedLength,1===i[f++]&&(d=t.i.unpack(i,f)),f+=t.i.packedLength;var y,v,b,k,x=new c.a,C=i[f++];for(n=0;n<C;n++){var w=o[i[f++]],S=i[f++];b=i[f++];var A=0!==i[f++],G=0!==i[f++];y=i[f++],v=r.ComponentDatatype.createTypedArray(S,y);for(var D=0;D<y;D++)v[D]=i[f++];x[w]=new s.o({componentDatatype:S,componentsPerAttribute:b,normalize:A,values:v}),G&&(x[w].isInstanceAttribute=!0)}if((y=i[f++])>0){var O=v.length/b;for(k=u.IndexDatatype.createTypedArray(O,y),n=0;n<y;n++)k[n]=i[f++]}a[p++]=new s.I({primitiveType:h,geometryType:l,boundingSphere:m,boundingSphereCV:d,indices:k,attributes:x,offsetAttribute:g})}else a[p++]=void 0}return a},y.packCombineGeometryParameters=function(e,t){for(var r=e.createGeometryResults,n=r.length,o=0;o<n;o++)t.push(r[o].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:b(e.instances,t),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof a.n,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}},y.unpackCombineGeometryParameters=function(e){for(var t=k(e.packedInstances),r=e.createGeometryResults,n=r.length,o=0,s=0;s<n;s++)for(var c=y.unpackCreateGeometryResults(r[s]),p=c.length,u=0;u<p;u++){var d=c[u];t[o].geometry=d,++o}var h=i.t.clone(e.ellipsoid);return{instances:t,ellipsoid:h,projection:e.isGeographic?new a.n(h):new m.t(h),elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:f.y.clone(e.modelMatrix),createPickOffsets:e.createPickOffsets}},y.packCombineGeometryResults=function(e,t){n.e(e.geometries)&&function(e,t){for(var r=e.length,n=0;n<r;++n)v(e[n],t)}(e.geometries,t);var r=x(e.boundingSpheres),o=x(e.boundingSpheresCV);return t.push(r.buffer,o.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:r,boundingSpheresCV:o}},y.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:C(e.boundingSpheres),boundingSpheresCV:C(e.boundingSpheresCV)}},e.k=y}));
