define(["./createTaskProcessorWorker","./ComponentDatatype-662c7548","./Color-03dac52c","./getStringFromTypedArray-8f79e1b1","./S3MCompressType-4e18e587","./Cartographic-dafe811b","./PrimitiveType-44685a19","./S3MPixelFormat-7c66b6aa","./pako_inflate-e5e032ee","./when-207a1520","./Check-07c613bc","./WebGLConstants-8d1e45f7","./FeatureDetection-fc084259","./Math-bae672f2","./RuntimeError-b98f87df","./Buffer-bf3c9fbe","./IndexDatatype-447558fc","./Cartesian4-58d59766"],(function(t,e,r,n,a,i,o,E,s,y,p,u,T,l,f,A,v,_){"use strict";function m(t,e,r,n,a,i){this.left=t,this.bottom=e,this.right=r,this.top=n,this.minHeight=a,this.maxHeight=i,this.width=r-t,this.length=n-e,this.height=i-a}function c(t,r,n,E,s,y,p,u){var T=s.getUint32(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT;var l=0,f={},A=f.vertexAttributes=[],v=f.attrLocation={};f.instanceCount=0,f.instanceMode=0;var _=0;s.getUint32(y,!0),y+=Uint32Array.BYTES_PER_ELEMENT;var m=s.getUint16(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT;var c=m;m>4&&(c=m>>8,m&=15);var d=s.getUint32(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT;var B=void 0,g=void 0;if(d>0){var P=s.getUint16(y,!0);P=m*Float32Array.BYTES_PER_ELEMENT,y+=Uint32Array.BYTES_PER_ELEMENT,l=d*P;var U=E.subarray(y,y+l);if(n){var L=new i.t,h=new i.t,M=new Float32Array(U.buffer,U.byteOffset,U.byteLength/4),S=new i.t$1;B=new i.t$1,g=new i.t$1;for(var N=new Float32Array(2*d),R=new Float64Array(2*d),D=0;D<d;D++)o.y.multiplyByPoint(r,i.t.fromElements(M[3*D],M[3*D+1],M[3*D+2],L),h),S=i.t$1.fromCartesian(h),R[2*D]=S.longitude,R[2*D+1]=S.latitude,0===D?(B.longitude=S.longitude,B.latitude=S.latitude,g.longitude=S.longitude,g.latitude=S.latitude):(B.longitude=Math.max(S.longitude,B.longitude),B.latitude=Math.max(S.latitude,B.latitude),g.longitude=Math.min(S.longitude,g.longitude),g.latitude=Math.min(S.latitude,g.latitude));for(D=0;D<d;D++)N[2*D]=R[2*D]-g.longitude,N[2*D+1]=R[2*D+1]-g.latitude;v.img=_,A.push({index:v.img,typedArray:N,componentsPerAttribute:2,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:2*Float32Array.BYTES_PER_ELEMENT,normalize:!1}),_++}if(u){h=new i.t,M=new Float32Array(U.buffer,U.byteOffset,U.byteLength/4);for(var Y=new Float32Array(U.byteLength/4+d),b=M.length,F=(D=0,0);D<b;D+=3,F+=4)Y[F]=M[D],Y[F+1]=M[D+1],Y[F+2]=M[D+2],o.y.multiplyByPoint(r,i.t.fromElements(Y[F],Y[F+1],Y[F+2],L),h),Y[F+3]=i.t$1.fromCartesian(h).height;U=Y,P=(m=4)*Float32Array.BYTES_PER_ELEMENT}v.aPosition=_,A.push({index:v.aPosition,typedArray:U,componentsPerAttribute:m,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:P,normalize:!1}),_++,y+=l}var I=s.getUint32(y,!0);if(y+=Uint32Array.BYTES_PER_ELEMENT,I>0){var x=s.getUint16(y,!0);x=c*Float32Array.BYTES_PER_ELEMENT,y+=Uint32Array.BYTES_PER_ELEMENT,l=I*x;let r=new Float32Array(E.buffer,y,3),n=0===r[0]&&0===r[1]&&0===r[2];t.ignoreNormal||n||(v.aNormal=_,A.push({index:v.aNormal,typedArray:E.subarray(y,y+l),componentsPerAttribute:c,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:x,normalize:!1}),_++),y+=l}var C=s.getUint32(y,!0);if(y+=Uint32Array.BYTES_PER_ELEMENT,C>0){var w=new Uint8Array(4*C);p.push(w.buffer);var O=s.getUint32(y,!0);O=4*Float32Array.BYTES_PER_ELEMENT,y+=Uint32Array.BYTES_PER_ELEMENT,l=C*O;for(var k=new Float32Array(E.buffer,y,4*d),z=0;z<d;z++)w[4*z]=255*k[4*z],w[4*z+1]=255*k[4*z+1],w[4*z+2]=255*k[4*z+2],w[4*z+3]=255*k[4*z+3];y+=l,v.aColor=_,A.push({index:v.aColor,typedArray:w,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.UNSIGNED_BYTE,offsetInBytes:0,strideInBytes:4,normalize:!0}),_++}var H=s.getUint32(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT,H>0&&(y+=l=16*H);var G=s.getUint32(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT;var $,W,V=-1;for(F=0;F<G;F++){$=s.getUint32(y,!0),y+=Uint32Array.BYTES_PER_ELEMENT,W=s.getUint16(y,!0),y+=Uint16Array.BYTES_PER_ELEMENT,s.getUint16(y,!0),y+=Uint16Array.BYTES_PER_ELEMENT,l=$*W*Float32Array.BYTES_PER_ELEMENT;var X=E.subarray(y,y+l);if(-1!=V||20!=W&&35!=W)if(-1!==V)f.instanceBounds=new Float32Array(E.buffer,y,$*W);else{var j="aTexCoord"+F;v[j]=_++,A.push({index:v[j],typedArray:X,componentsPerAttribute:W,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:W*Float32Array.BYTES_PER_ELEMENT,normalize:!1})}else{V=F,f.instanceCount=$,f.instanceMode=W,f.instanceBuffer=X;var q;b=W*$;20===W?(q=20*Float32Array.BYTES_PER_ELEMENT,v.uv2=_++,A.push({index:v.uv2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:q,instanceDivisor:1}),v.uv3=_++,A.push({index:v.uv3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.uv4=_++,A.push({index:v.uv4,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.secondary_colour=_++,A.push({index:v.secondary_colour,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.uv6=_++,A.push({index:v.uv6,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1})):35===W&&(q=35*Float32Array.BYTES_PER_ELEMENT,v.uv1=_++,A.push({index:v.uv1,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:q,instanceDivisor:1,byteLength:l}),v.uv2=_++,A.push({index:v.uv2,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:4*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.uv3=_++,A.push({index:v.uv3,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:8*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.uv4=_++,A.push({index:v.uv4,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:12*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.uv5=_++,A.push({index:v.uv5,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:16*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.uv6=_++,A.push({index:v.uv6,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:20*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.uv7=_++,A.push({index:v.uv7,componentsPerAttribute:3,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:24*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.secondary_colour=_++,A.push({index:v.secondary_colour,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:27*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}),v.uv9=_++,A.push({index:v.uv9,componentsPerAttribute:4,componentDatatype:e.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:31*Float32Array.BYTES_PER_ELEMENT,strideInBytes:q,instanceDivisor:1}))}y+=l}f.verticesCount=d,f.instanceIndex=V;var J=s.getUint32(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT;var K,Q=[];for(F=0;F<J;F++){var Z={},tt=s.getUint32(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT;var et=s.getUint8(y,!0);y+=Uint8Array.BYTES_PER_ELEMENT,s.getUint8(y,!0),y+=Uint8Array.BYTES_PER_ELEMENT;var rt=s.getUint8(y,!0);y+=Uint8Array.BYTES_PER_ELEMENT,y+=1,Z.indicesCount=tt,Z.indexType=et,Z.primitiveType=rt;var nt=y;tt>0&&(0==et?(y+=l=tt*Uint16Array.BYTES_PER_ELEMENT,tt%2==1&&(y+=2)):y+=l=4*tt),Z.indicesTypedArray=E.subarray(nt,nt+l);var at=s.getUint32(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT;var it=s.getUint32(y,!0);y+=Uint32Array.BYTES_PER_ELEMENT*at,Z.materialCode=it,Q.push(Z)}return 2===Q.length&&13===Q[1].primitiveType&&Q[1].indicesCount>=3&&(K=a._0x48a01b.createEdgeDataByIndices(f,Q[1],p)),t[T]={vertexPackage:f,arrIndexPackage:Q,edgeGeometry:K,cartographicBounds:{max:B,min:g}},y}function d(t,r,n){var a=t.vertexAttributes,i=t.attrLocation,o=a.length;i[1===n?"instanceId":"batchId"]=o,a.push({index:o,typedArray:r,componentsPerAttribute:1,componentDatatype:e.ComponentDatatype.FLOAT,offsetInBytes:0,strideInBytes:0,instanceDivisor:n})}return new r.e,t((function(t,e){var r=t.buffer,i=t.supportCompressType,o=t.bVolume,p=null,u=null,T=null,l=t.isCoverImageryLayer,f=t.modelMatrix,A=t.isComputeHeight;if(o&&t.volbuffer.byteLength<8&&(o=!1),o){var v=t.volbuffer,_=new Uint8Array(v,8),B=s.pako.inflate(_).buffer,g=new Float64Array(B,0,1),P=new Uint32Array(B,48,1);if(0===g[0]||3200===P[0]||3201===P[0]){var U=0;0===g[0]&&(U=8),e.push(B);var L=new Float64Array(B,U,6),h=L[0],M=L[1],S=L[2],N=L[3],R=L[4]<L[5]?L[4]:L[5],D=L[4]>L[5]?L[4]:L[5];u={left:h,top:M,right:S,bottom:N,minHeight:R,maxHeight:D,width:(p=new m(h,N,S,M,R,D)).width,length:p.length,height:p.height};var Y=new Uint32Array(B,48+U,7),b=Y[0],F=Y[1],I=Y[2],x=Y[3];T={nFormat:b,nSideBlockCount:F,nBlockLength:I,nLength:x,nWidth:Y[4],nHeight:Y[5],nDepth:Y[6],imageArray:new Uint8Array(B,76+U,x*x*4)}}}var C=0,w=new Uint8Array(r,0,4);if(115!==w[0]||51!==w[1]||109!==w[2])return{result:!1};var O=w[3],k=(_=new Uint8Array(r,4),s.pako.inflate(_).buffer),z=new Uint8Array(k);e.push(z.buffer);var H=new DataView(k),G=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var $=new Uint8Array(k,C,G),W=G%4;W&&(W=4-W),C+=G+W;var V=n.a($,void 0,void 0,"gbk");V=(V=V.replace(new RegExp("\r\n","gm"),"")).replace(new RegExp(":","gm"),""),H.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var X=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var j={};j.ignoreNormal=t.ignoreNormal;for(var q=0;q<X;q++)C=c(j,f,l,z,H,C,e,A);H.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var J=H.getUint32(C,!0);for(C+=Uint32Array.BYTES_PER_ELEMENT,q=0;q<J;q++){var K=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Q=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Z={},tt=j[K].vertexPackage.instanceIndex,et=j[K].edgeGeometry;if(-1==tt){for(var rt=new Float32Array(j[K].vertexPackage.verticesCount),nt=0;nt<Q;nt++){var at=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var it=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var ot=0,Et=0;Z[at]={batchId:nt};for(var st=0;st<it;st++)if(Et=H.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT,ot=H.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT,rt.fill)rt.fill(nt,Et,Et+ot);else for(var yt=Et+Et,pt=Et;pt<yt;pt++)rt[pt]=nt;Z[at].vertexColorOffset=Et,Z[at].vertexColorCount=ot}d(j[K].vertexPackage,rt,void 0)}else{var ut=j[K].vertexPackage.instanceCount;j[K].vertexPackage.instanceBuffer,j[K].vertexPackage.instanceMode;var Tt=new Float32Array(ut),lt=0;for(nt=0;nt<Q;nt++){at=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;it=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;for(st=0;st<it;st++){var ft=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT,Tt[lt]=lt,void 0===Z[at]&&(Z[at]={vertexColorCount:1,instanceIds:[],vertexColorOffset:lt}),Z[at].instanceIds.push(ft),lt++}}d(j[K].vertexPackage,Tt,1)}j[K].pickInfo=Z;et=j[K].edgeGeometry;if(y.e(et)){var At,vt,_t=et.regular.instancesData,mt=a._0x48a01b.RegularInstanceStride;if(y.e(_t))for(vt=_t.length,At=0;At<vt;At+=mt){var ct=_t[At+9];_t[At+9]=rt[ct]}var dt=et.silhouette.instancesData;if(mt=a._0x48a01b.SilhouetteInstanceStride,y.e(dt))for(vt=dt.length,At=0;At<vt;At+=mt){ct=dt[At+12];dt[At+12]=rt[ct]}}}H.getUint32(C,!0),C+=Uint32Array.BYTES_PER_ELEMENT;var Bt=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var gt={};for(q=0;q<Bt;q++){var Pt=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Ut=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Lt=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var ht=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;it=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var Mt=H.getUint32(C,!0);C+=Uint32Array.BYTES_PER_ELEMENT;var St=null;if(ht===a.S3MCompressType.enrS3TCDXTN&&1!==i){var Nt=null;Mt>E.S3MPixelFormat.BGR||Mt===E.S3MPixelFormat.LUMINANCE_ALPHA?(Nt=new Uint8Array(k,C,Ut*Lt),St=new Uint8Array(Ut*Lt*4)):(Nt=new Uint16Array(k,C,it/2),St=new Uint16Array(Ut*Lt)),a.L.decode(St,Ut,Lt,Nt,Mt),e.push(St.buffer),ht=0}else St=new Uint8Array(k,C,it);gt[Pt]={id:Pt,width:Ut,height:Lt,compressType:ht,nFormat:Mt,imageBuffer:St},C+=it}return{result:!0,version:O,xmlDoc:V,geoPackage:j,texturePackage:gt,volImageBuffer:T,volBounds:u}}))}));
